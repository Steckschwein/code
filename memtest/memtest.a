*=$1000
!src "../bios/defs.h.a"
!src "../bios/bios.h.a"

main
      ; Check zeropage
check_zp      
      ; Start at $ff
      ldy #$ff
      ; Start with pattern $03 : $ff
-     ldx #$01

--    lda pattern,x
      sta $00,y
 
      cmp $00,y
      bne zp_kaputt

      dex
      bne --

      dey
      bne -

      jmp check_mem 

      ; Broken ZP
zp_kaputt
      txa
      jsr lcdclear
      jsr lcdhex
-     jmp -


start_check = $1200

check_mem
      stz tmp1
loop      
-     lda $55 ; loop+1 
      sta start_check   ; Start at $0200. skip stack for now      
      lda start_check
      cmp $55
      bne memcheck_end
      

      ; phx
      ; phy
      ; ldx #$00
      ; ldy #$00
      ; jsr lcdxy
      ; lda loop+3
      ; jsr lcdhex
      ; lda loop+4
      ; jsr lcdhex
      ; ply  
      ; plx
      

      inc loop+3
      inc loop+6
      bne -

      inc loop+4
      inc loop+7
      bne -

      cmp #$aa
      beq +
      lda #$aa
      sta loop +1
      sta loop +9
      bra - 

+
memcheck_end
      sta tmp0

      jsr lcdclear

      lda #'$'
      jsr lcdprint
      lda loop+4
      jsr lcdhex
      lda loop+3
      jsr lcdhex

      lda #' '
      jsr lcdprint
      lda #'$'
      jsr lcdprint
      lda tmp0 
      jsr lcdhex

      +SetVector start_check, loop+3
      +SetVector start_check, loop+6

      ldx #$0a
      ldy #$01
      jsr lcdxy
      
      lda tmp1
      jsr lcdhex
      inc tmp1
      jmp loop
-     jmp -
      
pattern  !byte $aa,$55