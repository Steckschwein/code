*=$0200
!src "../bios/defs.h.a"
!src "../bios/bios.h.a"
adrl	   =$f3
adrh	   =$f4
main:
	lda   #<msg
	sta   msgptr
	lda   #>msg
	sta   msgptr+1

   jsr   lcdclear
   jsr   lcdstring

	lda   #$00
	sta   adrl
	lda   #$03
	sta   adrh
   ldy   #$00
   jsr   mem_ca
   ldx   #$00
-	
   lda   pattern, x
   sta   (adrl),y
	lda   (adrl),y
	cmp   pattern, x
	bne   +
   inx
   cpx   #$0a
   bne   -
   ldx   #$00
	iny
   bne   -
	inc   adrh
   jsr   mem_ca
	jmp   -
+	pha            ;save erroneous pattern
   jsr   mem_ca
   lda   #$20
   jsr   lcdprint   
   pla   
   jsr   lcdhex
;-	jmp -	
   jmp $f000

mem_ca:
   phx
   phy
   ldx #$09
   ldy #$01
   jsr lcdxy
   plx
   ply
 
   tya            ;save adress low byte
   pha

   lda   adrh
   jsr   lcdhex
   pla
   jsr   lcdhex
   rts
msg	!text "Memtest: ", $00
pattern  !byte $f0,$0f,$96,$69,$a9,$9a,$00,$ff