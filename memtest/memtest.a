*=$0200
;!src "../bios/defs.h.a"
;!src "../bios/bios.h.a"
adrl	   =$f0
adrh	   =$f1
   cld
   ldx   #$ff
   txs   
   ; for standalone test
   jmp   main
   !src "memtest.withoutbios.h.a"
main:
	lda   #<msg
	sta   msgptr
	lda   #>msg
	sta   msgptr+1

	lda   #$00
	sta   adrl
	lda   #$03
	sta   adrh
   ldy   #$00
   jsr   mem_ca
   ldx   #$00
-	
   lda   pattern, x
   sta   (adrl),y
	lda   (adrl),y
	cmp   pattern, x
	bne   +
   inx
   cpx   #$0a
   bne   -
   ldx   #$00
	iny
   bne   -
	inc   adrh
   jsr   mem_ca
	jmp   -
+	pha            ;save erroneous pattern
   jsr   mem_ca
   lda   #$20
   jsr   lcdprint   
   pla   
   jsr   lcdhex
-	jmp -	
mem_ca:
   tya            ;save adress low byte
   pha
   jsr   lcdclear
   jsr   lcdstring
   lda   adrh
   jsr   lcdhex
   pla
   jsr   lcdhex
   rts
msg	!text "Mem ", $00
pattern  !byte $f0,$0f,$96,$69,$a9,$9a,$00,$ff