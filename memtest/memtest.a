*=$1000
!src "../bios/defs.h.a"
!src "../bios/bios.h.a"

main
      ; Check zeropage
check_zp      
      ; Start at $ff
      ldy #$ff
      ; Start with pattern $03 : $ff
-     ldx #$01

--    lda pattern,x
      sta $00,y
 
      cmp $00,y
      bne zp_kaputt

      dex
      bne --

      dey
      bne -

      jmp check_mem 

      ; Broken ZP
zp_kaputt
      txa
      jsr lcdclear
      jsr lcdhex
-     jmp -


start_check = $1100

check_mem
      stz tmp1
loop      
-     ldx #$01
--    lda pattern,x

a     sta start_check   ; Start at $0200. skip stack for now      
b     lda start_check
      cmp pattern,x
      bne memcheck_end
      dex
      bne --
      

      inc a+1
      inc b+1
      bne -

      inc a+2
      inc b+2
      bne -

memcheck_end
      sta tmp0

      jsr lcdclear

      lda #'$'
      jsr lcdprint
      lda a+2
      jsr lcdhex
      lda a+1
      jsr lcdhex

      lda #' '
      jsr lcdprint
      lda #'$'
      jsr lcdprint
      lda tmp0 
      jsr lcdhex

      +SetVector start_check, a+1
      +SetVector start_check, b+1

      ldx #$0a
      ldy #$01
      jsr lcdxy
      
      lda tmp1
      jsr lcdhex
      inc tmp1
      jmp loop
-     jmp -
      
pattern  !byte $aa,$55