*=$1000
!src <defs.h.a>
!src <bios.h.a>
!src <via.h.a>
cnt = $03
	jsr lcdclear

	lda #cnt
	sta tmp0

	stz tmp1

	lda #$80
	sta $02f0
-		
	jsr chrin
	lda $02f0
	lsr
	sta $02f0
	jmp -

	sei

	lda #<count
	sta via1t1cl            ; set low byte of count
	lda #>count
	sta via1t1ch            ; set high byte of count

	lda #%11000000
	sta via1ier             ; enable VIA1 T1 interrupts

	lda #%01000000
	sta via1acr             ; T1 continuous, PB7 disabled

;	Set IRQ Vector

	+SetVector irq, irqvec
	cli

	
-	jmp -

irq
	bit via1ifr		; Interrupt from VIA?
	bpl +

	bit via1t1cl	; Acknowledge timer interrupt

	dec tmp0
	bne +
	
	lda #cnt
	sta tmp0
	
	lda $02f0
	cmp #%00001000
	bne ++
	lda #$80
	sta $02f0
	rti
++	clc
	ror $02f0
+	rti
	;jmp irqhandler
