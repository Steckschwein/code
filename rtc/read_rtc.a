*=$1000
!src <defs.h.a>
!src <bios.h.a>
!src <via.h.a>

main
    sei

    +Println
    
    jsr rtc_enable
    lda #$8f
    jsr spi_rw_byte
    lda #$00
    jsr spi_rw_byte
    jsr rtc_disable

    jsr rtc_enable
    lda #$00
    jsr spi_rw_byte

    jsr spi_r_byte
    jsr hexout

    lda #' '
    jsr chrout
    jsr spi_r_byte
    jsr hexout

    lda #' '
    jsr chrout

    jsr spi_r_byte
    jsr hexout

    jsr rtc_disable

    rts
rtc_disable
	pha

	; Deselect any SPI devices
	lda #%11111110
	sta via1portb
	
	pla
	rts

rtc_enable
	pha
	; Select SPI SS for keyboard
	lda #%01110110
	; and via1portb
	sta via1portb

	pla
	rts

; text	!text "Hallo!", $00
time_mask !text "00:00:00", $00
date_mask !text "00.00.00", $00