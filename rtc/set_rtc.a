*=$1000
!src <defs.h.a>
!src <via.h.a>
!src <bios.h.a>

	lda #dev_lcd
    sta chn_out

	jsr rtc_enable
	lda #$8f
	jsr spi_rw_byte
	lda #$04
	jsr spi_rw_byte
	jsr rtc_disable

	jsr write
	jsr write_date

-	jmp -


write 
	pha  
    jsr rtc_enable

    lda #$80
    jsr spi_rw_byte
    
    lda #$00
    jsr spi_rw_byte
    lda #$02
	jsr spi_rw_byte
	lda #$10
	jsr spi_rw_byte

	jsr rtc_disable
    pla
    rts

write_date
	pha
	jsr rtc_enable

    lda #$83
    jsr spi_rw_byte
    lda #$06
    jsr spi_rw_byte

    lda #$23
    jsr spi_rw_byte
    lda #$05
    jsr spi_rw_byte
    lda #$15
    jsr spi_rw_byte

	jsr rtc_disable


	pla
	rts


rtc_disable
	pha

	; Deselect any SPI devices
	lda #%11111110
	sta via1portb
	
	pla
	rts

rtc_enable
	pha
	; Select SPI SS for keyboard
	lda #%01110110
	; and via1portb
	sta via1portb

	pla
	rts
