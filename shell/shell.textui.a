!src "../vdp/t9929.h.a"
!src "../vdp/t99xx.lib.a"

.screen
	!align	255, 	0
	!fill	$300, 	' '
.cursor_x	!byte 0
.cursor_y	!byte 0

.textui_init_vdp
	jsr	vdp_display_off			;display off
	
	+SetVector charset, .adrl	;setup vram with characters
	ldx	#$08
	lda	#$00
	ldy	#$40+$00
	jsr	vdp_memcpy

	jsr	vdp_mode_gfx1_blank		;blank vram
	
	lda	#Cyan<<4|Black			;gfx 1 with cyan/black
	jsr	vdp_mode_gfx1
	
	stz	.cursor_x
	stz	.cursor_y
	
	rts
	
.textui_update_screen
	lda	#Gray
	jsr	vdp_bgcolor	
	+SetVector	.screen, .adrl
	lda	#$00
	ldy	#$40+$18
	ldx	#$03
	jsr	vdp_memcpy
	lda	#Black
	jsr	vdp_bgcolor
	rts	

.textui_chrout
	tay
;	jsr	.textui_set_screen_addr
	
	inc	.cursor_x
	lda	.cursor_x
	and	#$20
	cmp	#$20
	bne	+
	stz	.cursor_x
	inc	.cursor_y
+	rts

.textui_set_screen_addr
	lda	.cursor_x
	lda	.cursor_y	; * 32
	asl
	asl	
	asl	
	asl
	asl
	ora	.cursor_x
	sta	.screen
	
	lda	.cursor_y	; * 32
	lsr			; /8 -> page offset 0-2
	lsr
	lsr
	sta	.screen
	rts

_textui_println	
	ldy	#$00
-	lda	(msgptr),y
	beq	+
;	jsr .textui_chrout
	;test
	sta	.screen, y
	iny
	bne	-
+	rts
	
!macro	V_Print .word {
}

!macro	V_Println .word {
	+SetVector .word, msgptr
	jsr	_textui_println
}

.bg	!byte 0