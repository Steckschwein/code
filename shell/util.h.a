!ifdef util_h_a !eof

;subroutine wrapper because there is no JSR (yyxx) on 6502 or 65c02
mychrout 
	jsr	chrout
	jmp (outvec)

shexout
	pha
	phx
	
	tax
	lsr
	lsr
	lsr
	lsr				
	and     #%00001111      ;mask lsd for hex print
	ora     #"0"            ;add "0"
	cmp     #"9"+1          ;is it a decimal digit?
	bcc     +	            ;yes! output it
	adc     #6              ;add offset for letter a-f
+	
	jsr mychrout
	
	txa 
	and     #%00001111      ;mask lsd for hex print
	ora     #"0"            ;add "0"
	cmp     #"9"+1          ;is it a decimal digit?
	bcc     +	            ;yes! output it
	adc     #6              ;add offset for letter a-f
+
	jsr mychrout
	plx
	pla
	rts

sdecout
	bra +
	; Lookup table for decimal to ASCII
.dec_tbl		!byte 128,160,200
+  pha	
   phx
   phy
   ldx #1
   stx tmp1
   inx
   ldy #$40
-- sty tmp0
   lsr
-  rol
   bcs ++
   cmp .dec_tbl,x
   bcc +
++ sbc .dec_tbl,x
   sec
+  rol tmp0
   bcc -
   tay
   cpx tmp1
   lda tmp0
   bcc +
   beq ++
   stx tmp1
+  eor #$30

	jsr mychrout

++ tya
   ldy #$10
   dex
   bpl --
   ply
   plx
   pla
   rts