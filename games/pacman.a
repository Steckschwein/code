	*=	$1000
!src "../bios/defs.h.a"
!src "../bios/bios.h.a"

main:

	lda 	#$ff
	sta	via1ddrb

	lda	#$7e
	sta	via1portb
	lda	#$6c
	jsr	via_write_byte
	rts

via_write_byte:

	!macro via_bit_out {
			tya		
			lsr	;shift value and set carry
			tay	;save new value to y
			
			txa	;via state to accu
			ror   ;shift right and set bit 7 with carry set from above
			
			sta	via1portb	; toogle bit 0 for clck
			dec	via1portb	
	}
	
	pha
	phx
	phy	;safe regs
	
	tay					;data to y	
	lda 	via1portb	; initial via state to x
	ora	#$01			; bit 0 is set for later clock
	asl					; store in x but with 1 bit shift left for later easy use
	tax					; and safe back to x
	
	+via_bit_out
	+via_bit_out
	+via_bit_out
	+via_bit_out
	
	+via_bit_out
	+via_bit_out
	+via_bit_out
	+via_bit_out

	ply	;restore regs
	plx
	pla
	
	rts			
