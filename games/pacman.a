	*=	$1000
!src "../bios/defs.h.a"
!src "../bios/bios.h.a"

main:

	lda 	#$ff
	sta	via1ddrb

	LDA	#$96
	STA	via1portb
	lda	#$6c
	jsr	via_write_byte
	rts


via_write_byte:

	!macro via_bit_out {
			tya		
			lsr	;shift value and set carry
			tay	;save new value to y
			
			txa	;via state to accu
			lsr   ;shift right and set bit 7 with carry set from above
			
			eor	#$01	; toogle bit 0
			sta	via1portb
			inc	via1portb
	}
	
	pha
	phx
	phy	;safe regs
	
	tay	;data to y	
	ldx 	via1portb	; initial via state to x
	asl					; but with 1 bit shift left
	tax					; and safe back to x
	
	+via_bit_out
	+via_bit_out
	+via_bit_out
	+via_bit_out
	
	+via_bit_out
	+via_bit_out
	+via_bit_out
	+via_bit_out

	ply	;restore regs
	plx
	pla
	
	rts			
