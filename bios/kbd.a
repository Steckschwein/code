;---------------------------------------------------------------------
; enable keyboard controller on SPI bus
;---------------------------------------------------------------------
.kbd_enable
	pha
	; Select SPI SS for keyboard
	lda #%01111010
	; and via1portb
	sta via1portb

	pla
	rts

;---------------------------------------------------------------------
; disable keyboard controller on SPI bus
;---------------------------------------------------------------------
.kbd_disable
	pha

	; Deselect any SPI devices
	lda #%11111110
	sta via1portb
	
	pla
	rts

;---------------------------------------------------------------------
; get key from keyboard, wait if $00
;---------------------------------------------------------------------
.kbd_chrin
	phx
	phy

-	jsr .kbd_enable	
	lda #$00
	jsr .spi_rw_byte
	jsr .kbd_disable
	beq -
	
	ply
	plx
	rts
;---------------------------------------------------------------------
; get key from keyboard, no wait
;---------------------------------------------------------------------

.kbd_getkey
	phx
	phy

	jsr .kbd_enable	
	lda #$00
	jsr .spi_rw_byte
	jsr .kbd_disable
	
	ply
	plx
	rts