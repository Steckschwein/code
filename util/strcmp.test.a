    *=$1000
	jmp	test_suite
!src <bios.h.a>
!src <macro.h.a>
!src "strcmp.a"
!src "asm_unit.a"
	
test_dirs=9
test_input=*;   input_X + test_dirs; address of input + size of results

!macro SetTestInput .input {
    lda #<.input+test_dirs
    sta a0+1
    sta a1+1
    sta a2+1
    sta a3+1
    sta a4+1
    lda #<.input
    sta a5+1
    lda #>.input+test_dirs
    sta a0+2
    sta a1+2
    sta a2+2
    sta a3+2
    sta a4+2
    lda #>.input
    sta a5+2
}

test_suite
    +SetTestInput input_1
    jsr test
    +SetTestInput input_2
    jsr test
    +SetTestInput input_3
    jsr test
    +SetTestInput input_4
    jsr test
    +SetTestInput input_5
    jsr test
    +SetTestInput input_6
    jsr test
    +SetTestInput input_7
    jsr test
    +SetTestInput input_8
    jsr test
    +SetTestInput input_9
    jsr test
    +SetTestInput input_10
    jsr test
    +SetTestInput input_11
    jsr test
    +SetTestInput input_12
    jsr test
    rts    
    
test
    +Println
	ldx #0
	ldy #0
l1
	lda test_dir_tab,x
	sta dirptr
	lda test_dir_tab+1,x
	sta dirptr+1
    
	phx
	phy
	jsr match	; check <name>.<ext> against 11 byte dir entry <name> <ext>
	ply
	plx		
	lda	#0
	rol			;result in carry to bit 0	
a5	cmp	test_input, y
	bne	_failed
	jsr	_test_ok
    bra _ok
_failed
	;failed with 'y'
	jsr	_test_failed
_ok	
	iny
	inx
	inx
	cpx	#test_dir_tab_e-test_dir_tab
	bne	l1	
	rts
		
dir_1	     !text "FILE00  TXT"
dir_2	     !text "LL      BIN"	;2
dir_3	     !text "LS      BIN"	;4
dir_4	     !text "LOADER  BIN"	;6
dir_5	     !text "FILE04  TXT"	;8
dir_6	     !text "TEST    TXT"	;10
dir_7	     !text "PROGS      "	;12
dir_8	     !text ".          "	;14
dir_9	     !text "..         "	;16

input_1 	!byte 0,0,1,0,0,0,0,0,0
			!text "ls.bin",0
input_2 	!byte 0,1,1,1,0,0,0,0,0
			!text "l*.bin",0
input_3 	!byte 0,1,1,0,0,0,0,0,0
			!text "l?.bin",0
input_4 	!byte 0,1,1,1,0,0,0,0,0
			!text "l**.bin",0
input_5 	!byte 0,0,0,0,0,0,0,0,0
			!text "l??.bin",0
input_6 	!byte 0,0,0,1,0,0,0,0,0
			!text "l?????.bin",0
input_7 	!byte 0,0,1,0,0,0,0,0,0
			!text "Ls.bin",0
input_8 	!byte 0,0,0,0,0,0,0,1,0
			!text ".",0
input_9 	!byte 0,0,0,0,0,0,0,0,1
			!text "..",0
input_10 	!byte 0,0,0,0,0,0,0,0,0
			!text "test.txtfoobar",0
input_11 	!byte 0,0,0,0,0,1,0,0,0
			!text "test.txt",0
input_12 	!byte 0,0,0,0,0,0,1,0,0
			!text "progs",0

test_dir_tab
	!word dir_1
	!word dir_2
	!word dir_3
	!word dir_4
	!word dir_5
	!word dir_6
	!word dir_7
	!word dir_8
	!word dir_9
test_dir_tab_e
