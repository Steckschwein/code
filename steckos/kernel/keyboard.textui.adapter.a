.KEY_ESCAPE		= $1b
.KEY_CRS_UP		= 'A'
.KEY_CRS_DOWN	= 'B'
.KEY_CRS_RIGHT	= 'C'
.KEY_CRS_LEFT	= 'D'
.KEY_HOME	    = 'E'
.KEY_END    	= 'F'
.KEY_DEL	    = 'G'

.MODE_ESCAPE	= 1<<0

.flag !byte 0
.textui_out
    stz .flag
	cmp #.KEY_ESCAPE
	beq .escape
	cmp #.KEY_CRS_UP
	beq	.crs_up
	cmp #.KEY_CRS_DOWN
	beq	.crs_down
	cmp #.KEY_CRS_LEFT
	beq	.crs_left
	cmp #.KEY_CRS_RIGHT
	beq	.crs_right
	cmp #.KEY_HOME
	beq	.key_home
	cmp #.KEY_DEL
	beq	.key_del
	cmp #.KEY_END
	beq	.key_end
    jmp .textui_chrout
	
.cls
    jmp .textui_blank
.crs_pos1
	jmp	.textui_pos1
.crs_right
	jmp	.textui_incx
.crs_left
	jmp	.textui_decx
.crs_up	
	jmp	.textui_decy
.crs_down
	jmp	.textui_incy

.key_home
    ldx #0
    ldy #0
    jmp .textui_crsxy        
.key_end
    ldx #.COLS-1
    ldy crs_y
    jmp .textui_crsxy
.key_del
    ;TODO mhm... scroll n chars
    lda #' '
    jmp .textui_chrout
    
.escape
	lda	#.MODE_ESCAPE
	sta	.flag
	rts
