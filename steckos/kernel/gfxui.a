!src <t9929.h.a>
!address .gfxbuf = $2000
.safeirq !word 0
.gfxui_on
    sei
	jsr	vdp_display_off			;display off
	jsr vdp_mode_sprites_off	;sprites off

    lda #Black<<4|Black
    jsr vdp_mode_gfx2_blank
    
    ;TODO FIXME .gfxbuf may vary
    +SetVector  .gfxbuf, addr    ; where the image data are loaded
	lda	#<ADDRESS_GFX2_PATTERN
	ldy	#.WRITE_ADDRESS + >ADDRESS_GFX2_PATTERN
	ldx	#$18	;6k bitmap - $1800
	jsr	vdp_memcpy					;load the pic data

    +copyPointer  irqvec, irqsafe
    +SetVector  .blend_isr, irqvec
	jsr vdp_mode_gfx2			    ;enable gfx2 mode
    cli
    rts
    
.gfxui_off
    sei
    +copyPointer  irqsafe, irqvec
    cli
    rts
    
.blend_isr
    bit a_vreg
    bpl +

    pha
    lda #$80
    sta tmp5
    pla
    
+   rti