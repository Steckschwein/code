*=$1000
!src <defs.h.a>
!src <kernel.h.a>
!src <shell.h.a>
!address {
.content = $1100	
.ptr 	 = $c0
.endptr	 = $c2 
}


 	ldy #$00
-	lda (paramptr),y 
	beq +
	sta .filename,y
	iny
	bra -
+

	+copyPointer paramptr, filenameptr

	jsr open
 	phx

	lda errno
	bne .error

	
	+SetVector .content, sd_blkptr
	+SetVector .content, .ptr
	jsr read
	lda errno
	bne .error

	plx

	lda fd_area + FD_file_size + 0, x

	clc
	adc #<.content 
	sta .endptr

	lda fd_area + FD_file_size + 1, x
	
	adc #>.content
	sta .endptr+1

	jsr close
	ldy #$01
	lda #$00
	sta (.endptr),y


	
	ldy #$00
-	lda (.ptr),y
	beq .end
	jsr krn_chrout
	iny
	bne +
	inc .ptr+1
+
	bra -

.error
	+PrintString .errtxt

.end	
	jmp (retvec)
.errtxt		!text "load error", $00
.filename 	!text "            ",$00

