; sdcard pin assignment:
; SD   | Signal 		| VIA Port
;   1  |    /CS 		|          PB1
;   2  | CMD/DI (mosi)		|          CB2
;   5  |    CLK 		|	   PB0/CB1
;   7  | DAT/DO 		|          PB7

*=$1000
!src "../bios/defs.h.a"
!src "../bios/bios.h.a"
!src "fat32.h.a"

sd_blktarget = $0400




main
	sei

	jsr sd_select_card

	jsr lcdclear

	jsr sd_param_init

	lda #$00
	sta sd_blkptr
	lda #$04
	sta sd_blkptr+1

	jsr sd_read_block

	; write start sector from partition entry to cmd param buffer (in reverse order)
	lda sd_blktarget+BS_Partition0+PE_LBABegin+3
	sta sd_cmd_param

	lda sd_blktarget+BS_Partition0+PE_LBABegin+2
	sta sd_cmd_param+1
	
	lda sd_blktarget+BS_Partition0+PE_LBABegin+1
	sta sd_cmd_param+2
	
	lda sd_blktarget+BS_Partition0+PE_LBABegin
	sta sd_cmd_param+4	


	lda #$00
	sta sd_blkptr
	lda #$04
	sta sd_blkptr+1
	
	jsr sd_read_block

	ldx #$00
-	lda sd_blktarget + BS_VolLab2,x
	jsr lcdprint
	inx
	cpx #11
	bne -


	; lda #'N'
	; sta sd_blktarget + BS_VolLab2
	
	; jsr sd_write_block


	jsr sd_deselect_card


-	jmp -
