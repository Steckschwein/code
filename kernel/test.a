!src <defs.h.a>
!src <bios.h.a>
!src <via.h.a>

;text_mode_40 = 1

*=  $1000

    jmp main
!src "textui.a"
!src "keyboard.textui.adapter.a"

main
    sei
    +SetVector .test_irq, irqvec

    jsr	.textui_init0
    
	+SetVector .textui_chrout, outvec

    cli
	
-   
	jsr .keyin
    jsr chrout

    ldx #02
    ldy #01
    jsr .textui_crsxy
    
    bra -
    
.test_irq
	+save

	bit	a_vreg
	bpl ++	   ; VDP IRQ flag set?

	jsr	.textui_update_screen

++
	+restore
	rti

.keyin
-	jsr .getkey
	cmp #$00
	beq -
	rts 
    
.getkey
	phx

	lda #%01111010
	sta via1portb

	; lda #$ff
	jsr spi_r_byte
       
	ldx #%11111110
	stx via1portb

	plx
	rts
 