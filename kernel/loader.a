*=$1000
!src <defs.h.a>
!src <bios.h.a>
!src <t9929.h.a>


; 	system attribute has to be set on file system

!address {
	.dest = $d000
	.bios = $f000	
}

; .pages = (.payload_end - .payload) / 256 + 1



-
	
a	lda .payload
b	sta .dest

	inc a+1
	inc b+1
	bne -

	lda a+2
	cmp >.payload_end
	bne +
	
	lda a+1
	cmp <.payload_end
	bne +
	bra done
+
	inc a+2
	inc b+2
	bne -

-
	; lda b2+2
	; jsr hexout
	; lda b2+1
	; jsr hexout

a2	lda .bios
b2	sta .bios

	inc a2+1
	inc b2+1
	bne -

	inc a2+2
	inc b2+2
	bne -


done
	jsr	vdp_display_off			;display off
	+SetVector	.charset, .adrl	;load charset
	lda	#<ADDRESS_GFX1_PATTERN
	ldy	#.WRITE_ADDRESS + >ADDRESS_GFX1_PATTERN
	ldx	#$08					
	jsr	vdp_memcpy

	
	lda #$01
	sta memctl
	
	jmp .dest
	
!align 255,0
; *=$1100
.payload
!bin "kernel.bin"
.payload_end

!align 255,0
.charset
!bin "../charsets/char6x8.bin"
.charset_end

!src "../lib/t99xx.lib.a"