*=$1000
!src <defs.h.a>
!src <bios.h.a>

; 	system attribute has to be set on file system

!address {
	.dest = $d000
	.bios = $f000	
}

.pages = (.payload_end - .payload) / 256 + 1


	lda #.pages
	jsr hexout


-
a	lda .payload
b	sta .dest

	inc a+1
	inc b+1
	bne -

	lda a+2
	cmp >.payload_end
	bne +
	
	lda a+1
	cmp <.payload_end
	bne +
	bra done
+
	inc a+2
	inc b+2
	bne -

; -
; a2	lda .bios
; b2	sta .bios

; 	inc a2+1
; 	inc b2+1
; 	bne -

; 	inc a2+2
; 	inc b2+2
; 	bne -


done
	
	; lda #$01
	; sta $02f0
	
	jmp .dest
	
!align 255,0
; *=$1100
.payload
!bin "kernel.bin"
.payload_end
