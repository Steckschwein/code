vdp_sreg:
	sta   a_vreg
	+nops	VRAM_WAIT
	sty   a_vreg
	rts
	
	
vdp_display_off:
	lda	#v_reg1_16k	;enable 16K ram, disable screen
	sta 	a_vreg
	+nops	VRAM_WAIT
	lda	  #v_reg1
	sta   a_vreg
	rts

vdp_gfx1:
	rts
	
vdp_gfx2:
	rts
	
;	input:
;	adrl/adrh vector set to vdp init table for al 8 vdp registers
vdp_init_reg:
	; setup video registers
   ldy	#$00
   ldx	#v_reg0
-  lda  (adrl),y
   sta   a_vreg
   +nops VRAM_WAIT
   stx   a_vreg
   iny
   inx
   cpy   #$08
   bne   -
   
   stz	crs_x
   stz	crs_y
   
   rts
	
;
;   input
;	a - color
;
vdp_bgcolor:
	sta   a_vreg
	lda   #v_reg7
	+nops	VRAM_WAIT
	sta   a_vreg
	rts

vdp_load_sprites16:
;	input:
;	adrl/adrh vector set to sprite table
;	a - low byte vram adress
;	y - high byte vram adress
;  x - amount of sprites
	jsr	vdp_sreg
--	ldy	#$00
-	lda	(adrl),y
	+nops	VRAM_WAIT
	sta a_vram
	iny
	iny
	cpy	#$20
	bne	-
	ldy	#$00
	inc	adrl
-	lda	(adrl),y
	+nops	VRAM_WAIT
	sta a_vram
	iny
	iny
	cpy	#$20
	bne	-
	lda	adrl
	clc	
	adc	#$1f
	sta	adrl
	dex
	bne   --
	rts
	
;	input:
;	a - low byte vram adress
;	y - high byte vram adress
;  x - amount of bytes to fill with pattern
;	adrl - pattern
vdp_fills:
	jsr   vdp_sreg
	lda   adrl
-  +nops	VRAM_WAIT
	sta   a_vram
	dex
	bne	-
	rts
	
; fill vram with pattern
;
vdp_fill:
;	a - low byte vram adress
;	y - high byte vram adress
;	x - amount of 256byte blocks (page counter)
;	adrl - pattern
	jsr   vdp_sreg
   ldy   #$00
   lda   adrl
-  +nops	VRAM_WAIT
   sta   a_vram
   iny
   bne   -
   dex
   bne   -
   rts
	
;	input:
;	adrl/adrh vector set
;	a - low byte vram adress
;	y - high byte vram adress
;  x - amount of 256byte blocks (page counter)
vdp_memcpy:
	jsr   vdp_sreg
   ldy   #$00
-  lda   (adrl),y
   +nops	VRAM_WAIT
   sta   a_vram
   iny
   bne   -
   inc   adrh
   dex
   bne   -
   rts
	
;	input:
;	adrl/adrh vector set
;	a - low byte vram adress
;	y - high byte vram adress
;  x - amount of bytes to copy
vdp_memcpys:
	jsr	vdp_sreg
	ldy   #$00
-  lda   (adrl),y
	+nops	VRAM_WAIT
	sta   a_vram
	iny
	dex
	bne	-
	rts
	
vdp_print:
	ldy		#$00
	
--	jsr		vdp_set_addr
-	lda		(adrl),y
	beq		++
	cmp		#$0d
	bne		+
	stz		crs_x
	inc		crs_y
	iny
	jmp		--
+	+nops 	VRAM_WAIT
	sta		a_vram
	inc 		crs_x
	iny
	bne		-
++	rts

vdp_chrout:
	tay
	jsr		vdp_set_addr
+	+nops 	VRAM_WAIT
	sty		a_vram
	inc	crs_x
	lda	crs_x
	and	#$20
	cmp	#$20
	bne	+
	stz	crs_x
	inc	crs_y
+	rts

vdp_set_addr:
	lda	crs_x
	lda	crs_y	; * 32
	asl	
	asl	
	asl	
	asl
	asl
	ora	crs_x
	sta	a_vreg	
	
	lda	crs_y	; * 32
	lsr			; /8 -> page offset 0-2
	lsr
	lsr
	clc
	adc	#$18+$40
	sta	a_vreg
	rts

vdp_xy:
	stx	crs_x
	sty	crs_y
	rts
	
!macro V_GotoXY .x, .y {
	lda	.x
	sta crs_x
	lda .y
	sta	crs_y
}
